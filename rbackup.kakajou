#!/bin/bash
set -e

. /usr/local/share/hbackup.sh

sftpserver=/usr/local/bin/bodged-sftp-server
userhost=rbackup@sfere
volume=/usb

setup

echo "--- Saving /Users"
setstatus \
nhbackup --repo $volume \
        --sftp $userhost \
	--index $today/users \
	--root /Users \
	--exclude '/.Trash$' \
	--exclude '/.thumbnails' \
	--exclude '/.xvpics$' \
	--exclude '/.arch-revision-library$' \
	--exclude '/++pristine-trees$' \
	--exclude '/Library/Caches$' \
	--exclude '/.mozilla/.*/Cache$' \
	--exclude '/.kde/share/cache$' \
	--exclude '/.ccache$' \
	--one-file-system \
        --hint-file /space/root/hints.Users \
	--verbose \
	--backup 
echo

echo "--- Saving /local"
setstatus \
nhbackup --repo $volume \
        --sftp $userhost \
	--index $today/local \
	--root /local \
	--verbose \
        --hint-file /space/root/hints.local \
	--backup 
echo

echo "--- Saving /etc"
setstatus \
nhbackup --repo $volume \
        --sftp $userhost \
	--index $today/etc \
	--root /etc \
	--verbose \
        --hint-file /space/root/hints.etc \
	--backup 
echo


echo "--- Saving /sw"
setstatus \
nhbackup --repo $volume \
        --sftp $userhost \
	--index $today/sw \
	--root /sw \
	--verbose \
        --hint-file /space/root/hints.sw \
	--backup 
echo

echo "--- Done"

exit $status
